name: Create Release

on:
  workflow_dispatch:

  push:
    branches:
      - main

jobs:
    release:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v2
        - name: Create Release
          uses: actions/create-release@v1
          env:
            GITHUB_TOKEN: ${{ secrets.REPO_TOKEN }}
          with:
            tag_name: ${{ github.ref }}
            release_name: ${{ github.ref }} # Simply using the ref as the release name
            draft: true
            prerelease: false

    publish-pypi:
        needs: release
        runs-on: ubuntu-latest
        steps:
        - name: publish-pypi
          uses: actions/checkout@v2
          with:
            ref: ${{ github.ref }}
        - name: Setup Python
          uses: actions/setup-python@v2
          with:
          python-version: '3.x'
        - name: Build and publish to pypi
          uses: JRubics/poetry-publish@v2.0
          with:
            pypi_token: ${{ secrets.PYPI_API_TOKEN }}


